<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:ui="http://java.sun.com/jsf/facelets" 
	  xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>TMS Tables</title>
<style>
.renameHeaderGrid.ui-panelgrid>*>tr,
.renameHeaderGrid.ui-panelgrid .ui-panelgrid-cell {
    border: none;
}
</style>
</h:head>
<h:body>
<h:form id="rename">
    <p:dialog id="renameTEDialog" 
    		  header="Rename #{tableEdit.entityTag}" 
    		  widgetVar="renameTEDialog" 
    		  modal="true" 
    		  resizable="false" 
              showEffect="clip" 
              hideEffect="fold" >  
	    <p:panelGrid id="renameTEPanel" columns="2" cellpadding="4" styleClass="renameHeaderGrid">
	        <p:outputLabel value="#{tableEdit.entityTag} Name: " />  
	        <p:inputText id="txRenameTE" value="#{tableEdit.entityLabel}" widgetVar="newName"/>
	        <p:commandButton icon="ui-icon-check"   
	        				 value="OK" 
	        				 oncomplete="PF('renameTEDialog').hide()"
	        				 process="@form"
	        				 update=":form:tableEditorId"
	        				 onstart="$('rename').submit();"
	        				 />
			<p:commandButton icon="ui-icon-cancel" value="Cancel" type="button" onclick="PF('renameTEDialog').hide()"/>
		</p:panelGrid>  
    </p:dialog>
</h:form>

<h:form id="derive">
    <p:dialog id="deriveTEDialog" 
    		  header="Set #{tableEdit.entityTag} Derivation" 
    		  widgetVar="deriveTEDialog" 
    		  modal="true" 
    		  resizable="false" 
              showEffect="clip" 
              hideEffect="fold">  
	    <p:panelGrid id="deriveTEPanel" columns="2" cellpadding="4" styleClass="renameHeaderGrid">
	        <p:outputLabel value="#{tableEdit.entityTag} Derivation: " />  
	        <p:inputText id="txDeriveTE" value="#{tableEdit.entityDerivation}" widgetVar="newDeriv" size="30"/> 
	        <p:commandButton icon="ui-icon-check"   
	        				 value="OK" 
	        				 oncomplete="PF('deriveTEDialog').hide()"
	        				 update=":form:tableEditorId"
	        				 process="@form"
	        				 onstart="$('#derive').submit();"
	        				 />
			<p:commandButton icon="ui-icon-cancel" value="Cancel" type="button" onclick="PF('deriveTEDialog').hide()"/>
		</p:panelGrid>  
   </p:dialog>
</h:form>

<h:form id="format">
    <p:dialog id="formatTEDialog" 
    		  header="Set #{tableEdit.entityTag} Format" 
    		  widgetVar="formatTEDialog" 
    		  modal="true" 
    		  resizable="false" 
              showEffect="clip" 
              hideEffect="fold">  
	    <p:panelGrid id="deriveTEPanel" columns="2" cellpadding="4" styleClass="renameHeaderGrid">
	        <p:outputLabel value="#{tableEdit.entityTag} Format: " />  
	        <p:inputText id="txFormatTE" value="#{tableEdit.entityFormat}" widgetVar="newFormat" size="20"/> 
	        <p:commandButton icon="ui-icon-check"   
	        				 value="OK" 
	        				 oncomplete="PF('formatTEDialog').hide()"
	        				 update=":form:tableEditorId"
	        				 process="@form"
	        				 onstart="$('#format').submit();"
	        				 />
			<p:commandButton icon="ui-icon-cancel" value="Cancel" type="button" onclick="PF('formatTEDialog').hide()"/>
		</p:panelGrid>  
   </p:dialog>
</h:form>

<h:form id="form">
   <p:growl id="msgs" showDetail="true"/>
   
   <p:confirmDialog message="Do you really want to delete this column?" 
                     header="Delete Column" severity="alert" widgetVar="deleteColDialog" appendTo="@(body)">
        <p:commandButton id="confirmCD" value="Yes" update=":form:tableEditorId" oncomplete="PF('deleteColDialog').hide()" 
                         actionListener="#{tableEdit.deleteColumn}" />  
        <p:commandButton id="declineCD" value="No" onclick="PF('deleteColDialog').hide()" type="button" />  
   </p:confirmDialog>  
    
   <p:confirmDialog message="Do you really want to delete this row?" 
                     header="Delete Row" severity="alert" widgetVar="deleteRowDialog" appendTo="@(body)">
        <p:commandButton id="confirmRD" value="Yes" update=":form:tableEditorId" oncomplete="PF('deleteRowDialog').hide()" 
                         actionListener="#{tableEdit.deleteRow}" />  
        <p:commandButton id="declineRD" value="No" onclick="PF('deleteRowDialog').hide()" type="button" />  
   </p:confirmDialog>  
    
   <p:remoteCommand name="onCellEdit" update="@form" />
   <p:dataTable id="tableEditorId"
   				 var="row" 
   				 value="#{tableEdit.rows}" 
   				 editable="true"
   				 editMode="cell" 
   				 widgetVar="tableCell" 
   				 resizableColumns="true"
   				 scrollable="true"
   				 stickyHeader="true" 
   				 >
       <f:facet name="header">
           <p:outputLabel value="#{tableView.title}" style="font-weight:bold;font-size:125%"/>
       </f:facet>
       
       <p:ajax event="cellEdit" oncomplete="onCellEdit()" />
 
       <p:column styleClass="ui-widget-header">
			<p:outputLabel id="rowNames" value="#{row.label}" style="font-weight:bold;"/>
			<p:contextMenu for="rowNames" style="font-size:12px!important; text-align:left!important; margin-left: 0px!important;">
				<p:menuitem  value="Derive..." icon="ui-icon-calculator" oncomplete="PF('deriveTEDialog').show();" update=":derive:deriveTEDialog">
      				<f:setPropertyActionListener value="#{row}" target="#{tableEdit.selectedRow}" />
      			</p:menuitem>
				<p:menuitem  value="Rename..." icon="ui-icon-pencil" oncomplete="PF('renameTEDialog').show();" update=":rename:renameTEDialog">
      				<f:setPropertyActionListener value="#{row}" target="#{tableEdit.selectedRow}" />
      			</p:menuitem>
				<p:menuitem  value="Clear" icon="ui-icon-close" actionListener="#{tableEdit.clearRow(row)}" update="@form"/>
				<p:menuitem  value="Insert" icon="ui-icon-plus" actionListener="#{tableEdit.addRow(row)}" update="@form"/>
	        	<p:menuitem  value="Delete..." icon="ui-icon-trash" oncomplete="PF('deleteRowDialog').show()" >
      				<f:setPropertyActionListener value="#{row}" target="#{tableEdit.selectedRow}" />
	        	</p:menuitem>
			</p:contextMenu>
       </p:column>
       
       <c:forEach items="#{tableEdit.columns}" var="col">
          <p:column id="col_#{col.index}" >
            <f:facet name="header">
                <h:outputText value="#{col.label}"/>
                <h:outputText value="*" rendered="#{col.derived}" />
		        <p:contextMenu for="col_#{col.index}" style="font-size:12px!important; text-align:left!important; margin-left: 0px!important;">
					<p:menuitem  value="Derive..." icon="ui-icon-calculator" oncomplete="PF('deriveTEDialog').show();" update=":derive:deriveTEDialog">
	      				<f:setPropertyActionListener value="#{col}" target="#{tableEdit.selectedColumn}" />
	      			</p:menuitem>
		        	<p:menuitem  value="Rename..." icon="ui-icon-pencil" oncomplete="PF('renameTEDialog').show();" update=":rename:renameTEDialog">
	      				<f:setPropertyActionListener value="#{col}" target="#{tableEdit.selectedColumn}" />
	      			</p:menuitem>
					<p:menuitem  value="Format..." icon="ui-icon-calculator" oncomplete="PF('formatTEDialog').show();" update=":format:formatTEDialog">
	      				<f:setPropertyActionListener value="#{col}" target="#{tableEdit.selectedColumn}" />
	      			</p:menuitem>
		        	<p:menuitem  value="Clear" icon="ui-icon-close" actionListener="#{tableEdit.clearColumn(col)}" update="@form"/>
		        	<p:menuitem  value="Insert" icon="ui-icon-plus" actionListener="#{tableEdit.addColumn(col)}" update="@form"/>
		        	<p:menuitem  value="Delete..." icon="ui-icon-trash" oncomplete="PF('deleteColDialog').show()" >
	      				<f:setPropertyActionListener value="#{col}" target="#{tableEdit.selectedColumn}" />
		        	</p:menuitem>
		        </p:contextMenu>
   		   	 <p:tooltip id="colDerivTip" for="col_#{col.index}" value="#{col.derivation}" rendered="#{col.derived}"/>
            </f:facet>
          	<p:cellEditor>
               <f:facet name="output"><div align="center"><h:outputText value="#{col.formattedValue}" style="#{col.style}"/></div></f:facet>
               <f:facet name="input"><p:inputText value="#{col.rawValue}" style="width:96%"/></f:facet>
            </p:cellEditor>
       	  </p:column>
       </c:forEach>
	</p:dataTable>  
	
</h:form>
</h:body>
</html>