<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:ui="http://java.sun.com/jsf/facelets" 
	  xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>TMS Tables</title>
<style>
.contextButton .ui-button { border: none; background: none; }
.contextButton .ui-button.ui-state-hover, .ui-button.ui-state-focus, .ui-button.ui-state-active { border: none; background: none; }
</style>
</h:head>
<h:body>
<h:form id="form">
   <p:growl id="msgs" showDetail="true"/>
   
   <p:confirmDialog message="Do you really want to delete this column?" 
                     header="Delete Column" severity="alert" widgetVar="deleteColDialog" appendTo="@(body)">
        <p:commandButton id="confirm" value="Yes" update=":form:tableEditorId" oncomplete="PF('deleteColDialog').hide()" 
                         actionListener="#{tableEdit.deleteColumn}" />  
        <p:commandButton id="decline" value="No" onclick="PF('deleteColDialog').hide()" type="button" />  
   </p:confirmDialog>  
    
   <p:remoteCommand name="onCellEdit" action="#{tableEdit.onCellEdit}" update="@form" />
   <p:dataTable id="tableEditorId"
   				 var="row" 
   				 value="#{tableEdit.rows}" 
   				 editable="true"
   				 editMode="cell" 
   				 widgetVar="tableCell" 
   				 resizableColumns="true"
   				 scrollable="true"
   				 stickyHeader="true"
   				 >
       <f:facet name="header">
           <p:outputLabel value="#{tableView.title}" style="font-weight: bold;"/>
       </f:facet>
       
    	<p:ajax event="cellEdit" oncomplete="onCellEdit()" />
 
       <p:column >
           <p:cellEditor>
               <f:facet name="output">
               		<p:outputLabel value="#{row.label}" id="rowName"  style="font-weight:bold;">
			        <p:contextMenu for="rowName" style="font-size:12px!important; text-align:left!important; margin-left: 0px!important;">
		        		<p:menuitem  value="Derivation..." icon="ui-icon-close"/>
		        		<p:menuitem  value="Rename..." icon="ui-icon-close"/>
		        		<p:menuitem  value="Clear" icon="ui-icon-close" actionListener="#{tableEdit.clearRow(row)}" update="@form">
	      					<f:setPropertyActionListener value="#{row}" target="#{tableEdit.selectedRow}" />
		        		</p:menuitem>
		        		<p:menuitem  value="Insert" icon="ui-icon-plus" actionListener="#{tableEdit.addRow(row)}" update="@form"/>
	               	</p:contextMenu>
	               	</p:outputLabel>
               </f:facet>
               <f:facet name="input"><p:inputText value="#{row.label}" style="width:100%"/></f:facet>
           </p:cellEditor>
       </p:column>
       
       <c:forEach items="#{tableEdit.columns}" var="col">
          <p:column headerText="#{col.label}" id="col_#{col.index}">
            <f:facet name="header">
                <h:outputText value="#{col.label}"/>
		        <p:contextMenu for="col_#{col.index}" style="font-size:12px!important; text-align:left!important; margin-left: 0px!important;">
		        	<p:menuitem  value="Derivation..." icon="ui-icon-close"/>
		        	<p:menuitem  value="Rename..." icon="ui-icon-close"/>
		        	<p:menuitem  value="Clear" icon="ui-icon-close" actionListener="#{tableEdit.clearColumn(col)}" update="@form"/>
		        	<p:menuitem  value="Insert" icon="ui-icon-plus" actionListener="#{tableEdit.addColumn(col)}" update="@form"/>
		        	<p:menuitem  value="Delete..." icon="ui-icon-trash" oncomplete="PF('deleteColDialog').show()" >
	      				<f:setPropertyActionListener value="#{col}" target="#{tableEdit.selectedColumn}" />
		        	</p:menuitem>
		        </p:contextMenu>
            </f:facet>
          	<p:cellEditor>
               <f:facet name="output"><h:outputText value="#{col.formattedValue}" style="#{col.style}"/></f:facet>
               <f:facet name="input"><p:inputText value="#{col.rawValue}" style="width:96%"/></f:facet>
            </p:cellEditor>
       	  </p:column>
       </c:forEach>
	</p:dataTable>  
</h:form>
</h:body>
</html>